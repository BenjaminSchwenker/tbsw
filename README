Welcome to the world of test beam data analysis 


The test beam software framework (TBSW) deals with the reconstruction and analysis of test beam data obtained with the 
EUDET/AIDA reference telescope. Test beams are all about learning about a device under test, or DUT, installed in the 
centre of the reference telescope. The idea is to probe the device under test with charged tracks crossing the DUT at 
known times and precisely estimated kinematic parameters. 

The installation of the framework is covered in INSTALL. The text below covers the reconstruction of track data written  
to disk.   


For the impatient reader: 


The root directory of TBSW contains a 'workspace' folder. The first step to analyse data from a new beam test is to make
a copy of this folder. For example: 

> cp -r workspace ~/workspace-my-beam-test

The idea of the folder 'workspace-my-beam-test' is to collect all steering files and analysis results from a specific beam
test. Raw data files (.raw or .slcio) should ideally be stored in a different place. This practice helps to disentangle 
data from different beam times and helps to reproduce results at a later time ;) 


Next, go to your new workspace folder and setup all environment variables. 

> . init_tbsw.sh

A test beam with the EUDET/AIDA telescope results in a number of .raw files stored at some location 'rawfiles'. The conversion 
of these .raw files into .slcio files can be handled using a converter skript. For help, just type 

> ./converter.py -h 

The command  

>./converter.py -i 'some/absolute/or/relative/path/file*.raw' -o 'folder/to/put/files/'

creates a list of .raw files matching the pattern 'file*.raw' and converts each to a file 'file*.slcio' in the output folder
'folder/to/put/files/'. The python script uses pythons multiprocessing module to speed up the conversion.  

Before we can analyse the .slcio files, a few configuration files need to be edited. The most important one is the 'gearfile',
an XML file used to define the geometry of the beam test telescope. Example gearfiles can be found in the folder gear-files. 
In case the geometry was changed during the beam time, more than one gearfile is needed.

Beside the gearfile, we need additional XML steering files for the Marlin processors doing the actual data processing. 
These steering files should be placed in the folder 'steering-files'. The folder contains steering files for the example of 
X0 imaging, namely the file 'reco-x0-tb.xml' for reconstruction and a group of files in the folder 'x0-tb' for 
calibration of the telescope. 

In case of x0 imaging, no new steering files are needed and we can proceed to running the analysis. The first part of the
analysis is to run the calibrate.py skript. This skript runs a hot-pixel killer, performs a pre alignment based on hit 
correlations and a track based alignment using the Kalman Alignment Algorithm. The command 

> .calibrate.py -i '~/path/to/converted/run12.slcio' -x 'steering-files/x0-tb' -c 'dummy'

creates a hot-pixel mask for all M26 sensors in the AIDA telescope and an alignment data base using data from run12. It uses 
steering files in the folder 'steering-files/x0-tb'. The calibration files will be written to the folder 'cal-files/dummy'
in the current workspace. The -c option defines a calibration tag other than the default tag 'dummy'. In case you have multiple
geometries (and multiple gearfiles), you will probably want to create calibration 
tags for each of them. 

The calibrate.py skript populates the folder 'tmp-runs/run12-dummy' with root files containing DQM histos to check the quality of the
calibration. It is worthwhile to have a look at these histograms to make sure the calibration was successful. In addition, text log files for 
all parts of the calibration are created.    

Once we have a calibration tag, we can run the actual reconstruction over one or more runs. For this the reco.py skript can be used.
For our x0 imaging example, the command is

> ./reco.py -i '~/path/to/converted/file*.slcio' -x 'steering-files/x0-tb/reco.xml'

The reco.py skript will populate the folder dqm-files with root files containing DQM histograms. The root files can be browsed directly using
roots TBrowser. In addition, some useful root macros can be found in the 'root-scripts' folder in the workspace. For X0 studies, have a look 
in the 'root-scripts/x0imaging' sub folder. 


Have fun with test beams ;)  

benjamin.schwenker@phys.uni-goettingen.de